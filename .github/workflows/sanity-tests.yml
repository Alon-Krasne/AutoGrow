name: Sanity Tests

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:

jobs:
  sanity-check:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: Check project structure
        run: |
          echo "ğŸ” Checking project structure..."
          
          # Check main directories exist
          test -d src/claude-agent && echo "âœ… Claude agent directory exists" || echo "âŒ Claude agent directory missing"
          test -d src/gemini-agent && echo "âœ… Gemini agent directory exists" || echo "âŒ Gemini agent directory missing"
          test -d tests && echo "âœ… Tests directory exists" || echo "âŒ Tests directory missing"
          test -d .github/workflows && echo "âœ… Workflows directory exists" || echo "âŒ Workflows directory missing"
          
          # Check key files exist
          test -f src/claude-agent/claude_cli_agent.py && echo "âœ… Claude CLI agent exists" || echo "âŒ Claude CLI agent missing"
          test -f src/gemini-agent/gemini_agent.py && echo "âœ… Gemini agent exists" || echo "âŒ Gemini agent missing"
          test -f tests/unit/test_claude_cli_agent.py && echo "âœ… Claude unit tests exist" || echo "âŒ Claude unit tests missing"
          test -f tests/unit/test_gemini_agent.py && echo "âœ… Gemini unit tests exist" || echo "âŒ Gemini unit tests missing"
      
      - name: Check Python syntax
        run: |
          echo "ğŸ” Checking Python syntax..."
          
          # Check Claude agent
          python -m py_compile src/claude-agent/claude_cli_agent.py && echo "âœ… Claude agent syntax OK" || echo "âŒ Claude agent syntax error"
          
          # Check Gemini agent
          python -m py_compile src/gemini-agent/gemini_agent.py && echo "âœ… Gemini agent syntax OK" || echo "âŒ Gemini agent syntax error"
          
          # Check logging config
          test -f src/logging_config.py && python -m py_compile src/logging_config.py && echo "âœ… Logging config syntax OK" || echo "âš ï¸ Logging config not found or has syntax error"
      
      - name: Check bash scripts
        run: |
          echo "ğŸ” Checking bash scripts..."
          
          # Check Claude scripts
          for script in src/claude-agent/scripts/*.sh; do
            if [ -f "$script" ]; then
              bash -n "$script" && echo "âœ… $(basename $script) syntax OK" || echo "âŒ $(basename $script) syntax error"
            fi
          done
          
          # Check Gemini scripts
          for script in src/gemini-agent/scripts/*.sh; do
            if [ -f "$script" ]; then
              bash -n "$script" && echo "âœ… $(basename $script) syntax OK" || echo "âŒ $(basename $script) syntax error"
            fi
          done
      
      - name: Sanity check summary
        if: always()
        run: |
          echo "âœ… Sanity checks completed"
          echo ""
          echo "Note: This workflow performs basic sanity checks."
          echo "For full testing, see the 'Test AI Agents' workflow."
